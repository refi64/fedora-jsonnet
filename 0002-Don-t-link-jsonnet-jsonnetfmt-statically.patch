From 95b80e67ddcba8ac3c299b42faf22deefacae197 Mon Sep 17 00:00:00 2001
From: Ryan Gonzalez <rymg19@gmail.com>
Date: Tue, 6 Aug 2019 12:51:00 -0500
Subject: [PATCH 2/4] Don't link jsonnet/jsonnetfmt statically

---
 cmd/CMakeLists.txt  |  8 ++++----
 core/CMakeLists.txt | 11 ++---------
 2 files changed, 6 insertions(+), 13 deletions(-)

diff --git a/cmd/CMakeLists.txt b/cmd/CMakeLists.txt
index 66e6aa0..5384d74 100644
--- a/cmd/CMakeLists.txt
+++ b/cmd/CMakeLists.txt
@@ -2,16 +2,16 @@
 
 if (BUILD_JSONNET OR BUILD_TESTS)
     add_executable(jsonnet ${LIBJSONNET_SOURCE} jsonnet.cpp utils.cpp)
-    add_dependencies(jsonnet libjsonnet_static)
-    target_link_libraries(jsonnet libjsonnet_static)
+    add_dependencies(jsonnet libjsonnet)
+    target_link_libraries(jsonnet libjsonnet)
 
 	install(TARGETS jsonnet DESTINATION "${CMAKE_INSTALL_BINDIR}")
 endif()
 
 if (BUILD_JSONNETFMT OR BUILD_TESTS)
     add_executable(jsonnetfmt ${LIBJSONNET_SOURCE} jsonnetfmt.cpp utils.cpp)
-    add_dependencies(jsonnetfmt libjsonnet_static)
-    target_link_libraries(jsonnetfmt libjsonnet_static)
+    add_dependencies(jsonnetfmt libjsonnet)
+    target_link_libraries(jsonnetfmt libjsonnet)
 
 	install(TARGETS jsonnetfmt DESTINATION "${CMAKE_INSTALL_BINDIR}")
 endif()
diff --git a/core/CMakeLists.txt b/core/CMakeLists.txt
index ddedf7d..0c35848 100644
--- a/core/CMakeLists.txt
+++ b/core/CMakeLists.txt
@@ -43,13 +43,6 @@ install(TARGETS libjsonnet
 	ARCHIVE DESTINATION "${CMAKE_INSTALL_LIBDIR}"
 	PUBLIC_HEADER DESTINATION "${CMAKE_INSTALL_INCLUDEDIR}")
 
-# Static library for jsonnet command-line tool.
-add_library(libjsonnet_static STATIC ${LIBJSONNET_SOURCE})
-add_dependencies(libjsonnet_static md5 stdlib)
-target_link_libraries(libjsonnet_static md5)
-set_target_properties(libjsonnet_static PROPERTIES OUTPUT_NAME jsonnet)
-install(TARGETS libjsonnet_static DESTINATION "${CMAKE_INSTALL_LIBDIR}")
-
 # Tests
 
 function(add_test_executable test_name)
@@ -60,9 +53,9 @@ function(add_test_executable test_name)
     endif()
     add_executable(${test_name} ${test_name}.${TEST_EXT})
 
-    add_dependencies(${test_name} libjsonnet_static GTest::Main)
+    add_dependencies(${test_name} libjsonnet GTest::Main)
     target_link_libraries(
-        ${test_name} GTest::GTest GTest::Main libjsonnet_static)
+        ${test_name} GTest::GTest GTest::Main libjsonnet)
 endfunction()
 
 if (BUILD_TESTS)
-- 
2.21.0

